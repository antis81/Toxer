PROJECT (Toxer)
CMAKE_MINIMUM_REQUIRED (VERSION 3.5)

IF (NOT CMAKE_BUILD_TYPE)
  SET(CMAKE_BUILD_TYPE Release)
ENDIF()

SET (PROJECT_VERSION_MAJOR 1)
SET (PROJECT_VERSION_MINOR 0)
SET (PROJECT_VERSION_PATCH 0)
SET (PROJECT_VERSION_TWEAK "pre-alpha")
SET (PROJECT_VERSION
    "${PROJECT_VERSION_MAJOR}.${PROJECT_VERSION_MINOR}.${PROJECT_VERSION_PATCH}"
    )
IF (NOT PROJECT_VERSION_TWEAK STREQUAL "")
SET(PROJECT_VERSION "${PROJECT_VERSION}-${PROJECT_VERSION_TWEAK}")
ENDIF()
ADD_DEFINITIONS (-DTOXER_VERSION="${PROJECT_VERSION}")

SET (CMAKE_MODULE_PATH ${toxer_SOURCE_DIR}/cmake)
SET (CMAKE_CXX_STANDARD 11)
SET (CMAKE_CXX_STANDARD_REQUIRED ON)

FILE (GLOB_RECURSE SCRIPTS "scripts/*.*")
ADD_CUSTOM_TARGET(scripts SOURCES ${SCRIPTS})

FIND_PACKAGE (Qt5 COMPONENTS Core Quick)
QT5_ADD_RESOURCES (RESOURCES res/res.qrc qml/qml.qrc)

SET (CMAKE_AUTOMOC ON)

ADD_SUBDIRECTORY (lib)

SET (TOX_LIBS
    toxencryptsave
    toxav
    toxcore
    toxgroup
    toxmessenger
    toxfriends
    toxdht
    toxnetcrypto
    toxcrypto
    toxnetwork
    )

SET (SRC_FILES ${SRC_FILES}
    src/IToxNotify.cpp
    src/main.cpp
    src/Private/ToxBootstrap.cpp
    src/Private/ToxerPrivate.cpp
    src/Private/ToxProfile.cpp
    src/Settings.cpp
    src/Toxer.cpp
    src/ToxTypes.cpp
    )

FILE (GLOB_RECURSE JS_FILES "qml/*.js")
ADD_CUSTOM_TARGET (js_files SOURCES ${JS_FILES})

FILE (GLOB_RECURSE QML_FILES "qml/*.qml")
ADD_CUSTOM_TARGET (qml_files SOURCES ${QML_FILES})

ADD_EXECUTABLE (toxer
    ${SRC_FILES}
    ${RESOURCES}
    )

TARGET_LINK_LIBRARIES (toxer
    ${TOX_LIBS}
    )

QT5_USE_MODULES (toxer Core Quick)

SET_PROPERTY (TARGET toxer APPEND PROPERTY COMPILE_DEFINITIONS
    QT_NO_CAST_FROM_ASCII
    QT_NO_CAST_TO_ASCII
    QT_NO_CAST_FROM_BYTEARRAY
    )

TARGET_INCLUDE_DIRECTORIES (toxer PRIVATE
    $<BUILD_INTERFACE:
    ${CMAKE_CURRENT_SOURCE_DIR}/src
    >)
